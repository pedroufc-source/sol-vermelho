<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sol Vermelho - Fortaleza 3D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: #000;
            font-family: 'Courier New', monospace;
        }

        canvas {
            display: block;
        }

        /* HUD Overlay */
        #hud {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        /* Health/Armor bars */
        #stats {
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .stat-bar {
            width: 200px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #fff;
            margin-bottom: 5px;
        }

        .stat-fill {
            height: 100%;
            transition: width 0.3s;
        }

        #health-fill {
            background: linear-gradient(to right, #ff0000, #ff4444);
            width: 100%;
        }

        #armor-fill {
            background: linear-gradient(to right, #0066ff, #4488ff);
            width: 0%;
        }

        /* Wanted stars */
        #wanted {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 5px;
        }

        .star {
            width: 30px;
            height: 30px;
            font-size: 24px;
            color: #333;
            text-shadow: 0 0 3px #000;
        }

        .star.active {
            color: #ffdd00;
            text-shadow: 0 0 10px #ffdd00;
        }

        /* Info panel */
        #info {
            position: absolute;
            top: 80px;
            right: 20px;
            text-align: right;
            color: #fff;
            text-shadow: 2px 2px 4px #000;
        }

        #money {
            font-size: 24px;
            color: #00ff00;
        }

        #weapon {
            font-size: 18px;
            color: #ffaa00;
        }

        #zone {
            font-size: 16px;
            color: #88ccff;
            margin-top: 10px;
        }

        /* Bottom info */
        #bottom-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #fff;
            font-size: 14px;
            text-shadow: 2px 2px 4px #000;
        }

        /* Minimap */
        #minimap {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #fff;
        }

        #minimap canvas {
            width: 100%;
            height: 100%;
        }

        /* Loading screen */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #loading h1 {
            color: #ff0000;
            font-size: 48px;
            text-shadow: 0 0 20px #ff0000;
            margin-bottom: 20px;
        }

        #loading p {
            color: #fff;
            font-size: 18px;
        }

        /* Pause menu */
        #pause-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 500;
        }

        #pause-menu.active {
            display: flex;
        }

        #pause-menu h2 {
            color: #ff0000;
            font-size: 48px;
        }

        /* Controls help */
        #controls {
            position: absolute;
            bottom: 80px;
            left: 20px;
            color: #aaa;
            font-size: 12px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading">
        <h1>SOL VERMELHO</h1>
        <p>Carregando Fortaleza...</p>
    </div>

    <!-- HUD -->
    <div id="hud">
        <!-- Health/Armor -->
        <div id="stats">
            <div class="stat-bar">
                <div id="health-fill" class="stat-fill"></div>
            </div>
            <div class="stat-bar">
                <div id="armor-fill" class="stat-fill"></div>
            </div>
        </div>

        <!-- Wanted Level -->
        <div id="wanted">
            <span class="star">&#9733;</span>
            <span class="star">&#9733;</span>
            <span class="star">&#9733;</span>
            <span class="star">&#9733;</span>
            <span class="star">&#9733;</span>
            <span class="star">&#9733;</span>
        </div>

        <!-- Money/Weapon/Zone -->
        <div id="info">
            <div id="money">$0</div>
            <div id="weapon">PUNHOS</div>
            <div id="zone">MONTESE</div>
        </div>

        <!-- Controls help -->
        <div id="controls">
            WASD - Mover | SHIFT - Correr<br>
            Mouse - Mirar | Click - Atirar<br>
            Q - Trocar arma | E - Entrar/Sair ve√≠culo<br>
            P - Pausar
        </div>

        <!-- Bottom info -->
        <div id="bottom-info">
            <span id="time">08:00</span> |
            <span id="fps">60 FPS</span>
        </div>

        <!-- Minimap -->
        <div id="minimap">
            <canvas id="minimap-canvas" width="200" height="200"></canvas>
        </div>
    </div>

    <!-- Pause Menu -->
    <div id="pause-menu">
        <h2>PAUSADO</h2>
    </div>

    <!-- External Libraries -->
    <script src="../gta1_assets/WebGL-GTA/external/Three.js"></script>
    <script src="../gta1_assets/WebGL-GTA/external/Box2dWeb-2.1.a.3.min.js"></script>

    <!-- Sol Vermelho Core -->
    <script src="data/config.js"></script>
    <script src="core.js"></script>
    <script src="player.js"></script>
    <script src="fortaleza-map.js"></script>

    <!-- HUD Controller -->
    <script>
        var SV = SV || {};

        // HUD System
        SV.HUD = {
            elements: {},
            minimapCtx: null,

            init: function() {
                this.elements = {
                    healthFill: document.getElementById('health-fill'),
                    armorFill: document.getElementById('armor-fill'),
                    money: document.getElementById('money'),
                    weapon: document.getElementById('weapon'),
                    zone: document.getElementById('zone'),
                    time: document.getElementById('time'),
                    fps: document.getElementById('fps'),
                    stars: document.querySelectorAll('.star'),
                    pauseMenu: document.getElementById('pause-menu'),
                    loading: document.getElementById('loading')
                };

                // Minimap
                var minimapCanvas = document.getElementById('minimap-canvas');
                this.minimapCtx = minimapCanvas.getContext('2d');

                console.log('[SV] HUD initialized');
            },

            update: function(game) {
                if (!game || !game.player) return;

                var player = game.player;

                // Health/Armor bars
                this.elements.healthFill.style.width = player.health + '%';
                this.elements.armorFill.style.width = player.armor + '%';

                // Money
                this.elements.money.textContent = '$' + SV.State.money.toLocaleString();

                // Weapon
                var weapon = player.getCurrentWeapon();
                if (weapon) {
                    var ammoText = '';
                    if (!weapon.melee && weapon.ammo !== Infinity) {
                        var weaponName = player.weapons[player.curWeaponIdx];
                        var ammo = player.ammo[weaponName] || 0;
                        ammoText = ' [' + ammo + ']';
                    }
                    this.elements.weapon.textContent = weapon.name + ammoText;
                }

                // Zone
                var zone = game.getZoneAt(player.x, player.y);
                this.elements.zone.textContent = zone.name;

                // Time
                var hours = Math.floor(SV.State.gameTime / 60);
                var minutes = Math.floor(SV.State.gameTime % 60);
                this.elements.time.textContent =
                    String(hours).padStart(2, '0') + ':' +
                    String(minutes).padStart(2, '0');

                // Wanted stars
                for (var i = 0; i < this.elements.stars.length; i++) {
                    if (i < SV.State.wanted) {
                        this.elements.stars[i].classList.add('active');
                    } else {
                        this.elements.stars[i].classList.remove('active');
                    }
                }

                // Pause menu
                if (SV.State.paused) {
                    this.elements.pauseMenu.classList.add('active');
                } else {
                    this.elements.pauseMenu.classList.remove('active');
                }

                // Minimap
                this.updateMinimap(game);
            },

            updateMinimap: function(game) {
                var ctx = this.minimapCtx;
                var player = game.player;
                var scale = 200 / SV.Config.WORLD.WIDTH;

                // Clear
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, 200, 200);

                // Draw zones
                var zones = SV.Config.ZONAS;
                for (var i = 0; i < zones.length; i++) {
                    var z = zones[i];
                    ctx.fillStyle = z.classe === 'alta' ? '#446688' :
                                   z.classe === 'media' ? '#666655' : '#553322';
                    ctx.fillRect(
                        z.x * scale,
                        z.y * scale,
                        z.w * scale,
                        z.h * scale
                    );
                }

                // Draw player
                ctx.fillStyle = '#00ff00';
                ctx.beginPath();
                ctx.arc(
                    player.x * scale,
                    player.y * scale,
                    4, 0, Math.PI * 2
                );
                ctx.fill();

                // Draw player direction
                ctx.strokeStyle = '#00ff00';
                ctx.beginPath();
                ctx.moveTo(player.x * scale, player.y * scale);
                ctx.lineTo(
                    player.x * scale + Math.sin(player.rotation) * 10,
                    player.y * scale - Math.cos(player.rotation) * 10
                );
                ctx.stroke();
            },

            hideLoading: function() {
                this.elements.loading.style.display = 'none';
            },

            showLoading: function() {
                this.elements.loading.style.display = 'flex';
            }
        };

        // FPS counter
        var fpsCounter = {
            frames: 0,
            lastTime: 0,
            fps: 60,

            update: function() {
                this.frames++;
                var now = performance.now();

                if (now - this.lastTime >= 1000) {
                    this.fps = this.frames;
                    this.frames = 0;
                    this.lastTime = now;

                    var fpsEl = document.getElementById('fps');
                    if (fpsEl) {
                        fpsEl.textContent = this.fps + ' FPS';
                    }
                }
            }
        };

        // Main game loop with HUD updates
        var originalAnimate;

        window.onload = function() {
            console.log('[SV] Window loaded, starting game...');

            // Initialize HUD
            SV.HUD.init();

            // Start game
            var game = SV.start();

            // Override animate to include HUD updates
            originalAnimate = game.animate.bind(game);
            game.animate = function() {
                originalAnimate();
                SV.HUD.update(game);
                fpsCounter.update();
            };

            // Hide loading screen
            setTimeout(function() {
                SV.HUD.hideLoading();
            }, 500);
        };
    </script>
</body>
</html>
